%% 2値HLACを利用した間違い探し検出コード
close all;
clc;

% 注意:この方法(addpath)を使うとMATLAB Mobile(iOS)で動作しない
% またMATLAB Compilerでのaddpathは推奨されていないので使わないほうが良い
% % imgフォルダをMATLABPATH(path())に追加
% foldername = 'img';
% dir_org = pwd;
% fpath = fullfile(dir_org,foldername);
% if (~contains(path(),fpath) && ~isdeployed)
%     addpath(fpath);
% end

% WikipediaのPNGはインデックス付きの画像の模様
% 少し工夫が必要
[img,cmap] = imread('./img/Spot_the_difference.png');
img = ind2rgb(img, cmap); % rgbに変換

% サイズ取得
colsize = size(img,1); % 縦サイズ
rowsize = size(img,2); % 横サイズ

% 画像を左右に2等分する
img_L = img(1:colsize, 1:rowsize/2, :);
img_R = img(1:colsize, (rowsize/2 + 1):rowsize, :);


% 2値化する
imgL_bin = im2gray(img_L) > 127; 
imgR_bin = im2gray(img_R) > 127; 

% フィルタの準備(cell形式)
hlac_filters = { ...
    [0 0 0; 0 1 0; 0 0 0], ...
    [0 0 0; 0 1 1; 0 0 0], ...  
    [0 0 1; 0 1 0; 0 0 0], ...  
    [0 1 0; 0 1 0; 0 0 0], ...  
    [1 0 0; 0 1 0; 0 0 0], ...
    [0 0 0; 1 1 1; 0 0 0], ...  
    [0 0 1; 0 1 0; 1 0 0], ...  
    [0 1 0; 0 1 0; 0 1 0], ...  
    [1 0 0; 0 1 0; 0 0 1], ...  
    [0 0 1; 1 1 0; 0 0 0], ...  
    [0 1 0; 0 1 0; 1 0 0], ...  
    [1 0 0; 0 1 0; 0 1 0], ...  
    [0 0 0; 1 1 0; 0 0 1], ... 
    [0 0 0; 0 1 1; 1 0 0], ...  
    [0 0 1; 0 1 0; 0 1 0], ...  
    [0 1 0; 0 1 0; 0 0 1], ... 
    [1 0 0; 0 1 1; 0 0 0], ...  
    [0 1 0; 1 1 0; 0 0 0], ...  
    [1 0 0; 0 1 0; 1 0 0], ...  
    [0 0 0; 1 1 0; 0 1 0], ...  
    [0 0 0; 0 1 0; 1 0 1], ...  
    [0 0 0; 0 1 1; 0 1 0], ...  
    [0 0 1; 0 1 0; 0 0 1], ...  
    [0 1 0; 0 1 1; 0 0 0], ... 
    [1 0 1; 0 1 0; 0 0 0] ...
    };


% 描画
tiledlayout(1,2);
nexttile
imshow(img_L);
title('reference');

nexttile
imshow(img_R);
title('target');
